[build-system]
requires = [
  "setuptools>=80",
  "setuptools-scm>=8",
]
build-backend = "setuptools.build_meta"

[project]
name = "msgspec"
dynamic = [
  "classifiers",
  "description",
  "keywords",
  "license",
  "maintainers",
  "optional-dependencies",
  "readme",
  "requires-python",
  "urls",
  "version",
]

[tool.setuptools_scm]
version_file = "msgspec/_version.py"
parentdir_prefix_version = "msgspec-"

[tool.ruff]
extend-exclude = [
  "*.pyi",
  "__init__.py",
  "_version.py",
  "versioneer.py",
  "basic_typing_examples.py",
  "json.py",
  "msgpack.py",
  "test_JSONTestSuite.py",
  "conf.py",
]
line-length = 88

[tool.ruff.lint]
ignore = [
  "E721", # Comparing types instead of isinstance
  "E741", # Ambiguous variable names
  "E501", # Conflicts with ruff format
  "W191", # Conflicts with ruff format
]
select = [
  "E", # PEP8 Errors
  "F", # Pyflakes
  "W", # PEP8 Warnings
]

[tool.ruff.lint.isort]
combine-as-imports = true

[tool.cibuildwheel]
build = "cp39-* cp310-* cp311-* cp312-* cp313-* cp314-* cp314t-*"
build-frontend = "build[uv]"
test-command = "pytest {project}/tests"
test-extras = ["test"]

[tool.cibuildwheel.environment]
CFLAGS = "-g0"

# [tool.cibuildwheel.linux]
# environment-pass = ["CFLAGS"]

[tool.codespell]
skip = "*.py,*.c,*.h"

[tool.coverage.run]
omit = [
  "src/msgspec/_version.py",
  "tests/basic_typing_examples.py",
  "tests/test_mypy.py",
  "tests/test_pyright.py",
]

[tool.pytest.ini_options]
markers = [
  "mypy",
  "pyright",
]
filterwarnings = [
  "error",
]
